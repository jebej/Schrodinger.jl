<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DRAG · Schrodinger.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Schrodinger.jl</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../man/gettingstarted.html">Getting Started</a></li><li><a class="tocitem" href="../man/quantumobjects.html">Quantum Objects</a></li><li><a class="tocitem" href="../man/working.html">Working with States and Operators</a></li><li><a class="tocitem" href="../man/dynamics.html">Time Evolution and Dynamics</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="driven_TLS.html">The Driven Two-Level System</a></li><li class="is-active"><a class="tocitem" href="DRAG.html">DRAG</a><ul class="internal"><li><a class="tocitem" href="#A-simple-NOT-Gate"><span>A simple NOT Gate</span></a></li><li><a class="tocitem" href="#Three-level-system"><span>Three-level system</span></a></li><li><a class="tocitem" href="#Fidelity"><span>Fidelity</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api/quobj.html">Quantum Object Types</a></li><li><a class="tocitem" href="../api/states.html">State Library</a></li><li><a class="tocitem" href="../api/operators.html">Operator Library</a></li><li><a class="tocitem" href="../api/functions.html">Function Library</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="DRAG.html">DRAG</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="DRAG.html">DRAG</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jebej/Schrodinger.jl/blob/master/docs/src/examples/DRAG.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="DRAG"><a class="docs-heading-anchor" href="#DRAG">DRAG</a><a id="DRAG-1"></a><a class="docs-heading-anchor-permalink" href="#DRAG" title="Permalink"></a></h1><p>This example shows how to implement a NOT gate on a qubit using a Gaussian pulse. We then extend this method to a three-level slightly anharmonic energy spectrum with nearest level coupling. As we will see, the gate error increases due to leakage into the third level. To remedy this, we implement Derivative Removal by Adiabatic Gate (DRAG) which offers better gate fidelity than an ordinary Gaussian pulse (see the <a href="DRAG.html#References">References</a>).</p><h2 id="A-simple-NOT-Gate"><a class="docs-heading-anchor" href="#A-simple-NOT-Gate">A simple NOT Gate</a><a id="A-simple-NOT-Gate-1"></a><a class="docs-heading-anchor-permalink" href="#A-simple-NOT-Gate" title="Permalink"></a></h2><p>First, we will apply a simple NOT gate to a qubit in the ground state. The Hamiltonian for our qubit in the lab frame can be written as <span>$ħ(ω|1⟩⟨1|+ℇ(t)σ_x)$</span> where <span>$ħω$</span> is the transition energy, <span>$σ_x$</span> is the Pauli-X operator, and <span>$ℇ(t)=ℇ^x(t)\cos(ω_dt)$</span> represents our control of the system using a drive frequency <span>$ω_d$</span>. Any control <span>$ℇ^x(t)$</span> such that the integral of <span>$ℇ^x$</span> over the total gate time equals <span>$π$</span> will result in a complete inversion. It is common to use a Gaussian shaped π-pulse to implement a NOT gate. For our purposes, we will find it more convenient to work in the rotating frame with respect to our drive frequency <span>$ω_d$</span>. When this frequency is resonant with the qubit frequency <span>$ω$</span>, the Hamiltonian is given by <span>$ħℇ^x(t)σ_x/2$</span>. If we are going to solve the time dynamics for this system, we also have to define our pulse in the rotating frame.</p><pre><code class="language-julia hljs">using Schrodinger, SpecialFunctions, SparseArrays

function rotgaussianpulse(t::Real,p::Vector)
    # normalized pulse centered on t=0, begins and ends at 0
    tg  = p[1] # gate time
    σ   = p[2] # standard deviation
    A   = p[3] # amplitude
    B   = inv(√(2π)*σ*erf(tg/(√(8)*σ))-tg*gaussian(0.5tg,σ)) # normalize
    Ɛˣ = A*B*(gaussian(t,σ)-gaussian(0.5tg,σ))
    return Ɛˣ
end

H = σx/2 # same as create(2)/2 + destroy(2)/2; using natural units where ħ=1</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×2 Operator{SparseMatrixCSC{Float64, Int64}, 1} with dimensions 2
  ⋅   0.5
 0.5   ⋅ 
</code></pre><p>We are now ready to solve for the time dynamics and plot our results. We&#39;ll use parameters that are typical for Transmon qubits.</p><pre><code class="language-julia hljs">tg = 6e-9 # gate time 6ns
σ = 0.5tg # standard deviation of gaussian pulse
g = basis(2,0) # begin in ground state
tspan = (-tg/2,tg/2) # pulse centered at t=0

res1 = sesolve((qzero(2),(H,rotgaussianpulse,[tg,σ,π])),g,tspan,saveat=tg/200)

using PyPlot
plot(res1.times*1e9,levelprobs(res1.states)); grid();
xlabel(&quot;Time (ns)&quot;); ylabel(&quot;Level Probabilities&quot;);
legend([&quot;Ground State&quot;, &quot;Excited State&quot;]);</code></pre><p><img src="img/qubitNOT.svg" alt="qubit NOT gate"/></p><p>As is expected, the system moves from the ground state to the excited state.</p><h2 id="Three-level-system"><a class="docs-heading-anchor" href="#Three-level-system">Three-level system</a><a id="Three-level-system-1"></a><a class="docs-heading-anchor-permalink" href="#Three-level-system" title="Permalink"></a></h2><p>In reality, one must worry about leakage into other states of the system, especially when dealing with short gate times. Let&#39;s see how our Gaussian pulse performs on a three-level anharmonic system. We will again work in the rotating frame at resonance with the qubit frequency. This system will have an anharmonicity <span>$Δ$</span>, which is the detuning of the 2nd excited state with respect to the drive frequency, and an additional parameter <span>$λ$</span> describing the relative strength of the 1-2 transition compared to the 0-1 transition (see <a href="DRAG.html#References">[1]</a> for more details). Let&#39;s create the Hamiltonian and perform the same time evolution.</p><pre><code class="language-julia hljs">Δ = 2π*(-400e6) # anharmonicity
λ = √2 # relative transition strength
Π₂ = basis(3,2) * basis(3,2)&#39; # projector for the 2nd level
Hc = Δ*Π₂ # constant Hamiltonian
Hd = create(3)/2 + destroy(3)/2 # affected by Ɛˣ
g = basis(3,0)

res2 = sesolve((Hc,(Hd,rotgaussianpulse,[tg,σ,π])),g,tspan,saveat=tg/200)
plot(res2.times*1e9,levelprobs(res2.states)); grid()
xlabel(&quot;Time (ns)&quot;); ylabel(&quot;Level Probabilities&quot;);
legend([&quot;Ground State&quot;, &quot;1st Excited State&quot;, &quot;2nd Excited State&quot;]);</code></pre><p><img src="img/3levelNOT.svg" alt="3-level NOT gate"/></p><p>Instead of working perfectly, our system leaks into the 2nd energy level (we&#39;ll quantify this <a href="DRAG.html#Fidelity">later</a>). This becomes problematic when we&#39;re trying perform useful computations. DRAG is one possible remedy where introducing drive detuning and a second quadrature control, that is <span>$ℇ(t)=ℇ^x(t)\cos(ω_dt)+ℇ^y(t)\sin(ω_dt)$</span>, helps eliminate some of the leakage. Let&#39;s see how much of an improvement we get. We&#39;ll need to define a few more functions for the new controls.</p><pre><code class="language-julia hljs">function DRAGx(t::Real,p::Vector)
    # Ɛˣ for fifth order DRAG
    tg  = p[1] # gate time
    σ   = p[2] # standard deviation
    A   = p[3] # amplitude
    Δ   = p[4] # anharmonicity
    λ   = p[5] # relative strength of transitions
    Ɛˣ = rotgaussianpulse(t,[tg,σ,A]) + (λ^2-4)*rotgaussianpulse(t,[tg,σ,A])^3/(8*Δ^2) - (13λ^4-76λ^2+112)*rotgaussianpulse(t,[tg,σ,A])^5/(128Δ^4)
    return Ɛˣ
end

function DRAGy(t::Real,p::Vector)
    # Ɛʸ for fifth order DRAG
    tg  = p[1] # gate time
    σ   = p[2] # standard deviation
    A   = p[3] # amplitude
    Δ   = p[4] # anharmonicity
    λ   = p[5] # relative strength of transitions
    B   = inv(√(2π)*σ*erf(tg/(√(8)*σ))-tg*gaussian(0.5tg,σ))
    Ɛˣ′ = A*B*Schrodinger.gaussianprime(t,σ)
    Ɛʸ = -Ɛˣ′/Δ + 33*(λ^2-2)*rotgaussianpulse(t,[tg,σ,A])^2*Ɛˣ′/(24*Δ^3)
    return Ɛʸ
end

function dydet(t::Real,p::Vector)
    # dynamical detuning for fifth order DRAG
    tg  = p[1] # gate time
    σ   = p[2] # standard deviation
    A   = p[3] # amplitude
    Δ   = p[4] # anharmonicity
    λ   = p[5] # relative strength of transitions
    δ₁ = (λ^2-4)*rotgaussianpulse(t,[tg,σ,A])^2/(4*Δ) - (λ^4-7λ^2+12)*rotgaussianpulse(t,[tg,σ,A])^4/(16Δ^3)
    return δ₁
end

Π₁ = basis(3,1) * basis(3,1)&#39; # projector for 1st level
Hdet = Π₁ # affected by dynamical detuning
Hdx = create(3)/2 + destroy(3)/2 # affected by Ɛˣ
Hdy = im*create(3)/2 - im*destroy(3)/2 # affected by Ɛʸ

res3 = sesolve((Hc,(Hdet,dydet,[tg,σ,π,Δ,λ]),(Hdx,DRAGx,[tg,σ,π,Δ,λ]),(Hdy,DRAGy,[tg,σ,π,Δ,λ])),g,tspan,saveat=tg/200)
plot(res3.times*1e9,levelprobs(res3.states)); grid()
xlabel(&quot;Time (ns)&quot;); ylabel(&quot;Level Probabilities&quot;);
legend([&quot;Ground State&quot;, &quot;1st Excited State&quot;, &quot;2nd Excited State&quot;]);</code></pre><p><img src="img/3levelDRAG.svg" alt="3-level DRAG"/></p><p>There is a noticeable improvement over the simple Gaussian pulse, but how much better is the new gate?</p><h2 id="Fidelity"><a class="docs-heading-anchor" href="#Fidelity">Fidelity</a><a id="Fidelity-1"></a><a class="docs-heading-anchor-permalink" href="#Fidelity" title="Permalink"></a></h2><p>We can calculate the fidelity of our gates by comparing their output to the ideal case. Our gates behave ideally when <span>$λ=0$</span> and there is no leakage into the 2nd excited state. Using the same measure of error as in <a href="DRAG.html#References">[1]</a>, we can take the overall gate fidelity to be the average of gate fidelities when using the 6 axial states on the Bloch sphere as inputs.</p><pre><code class="language-julia hljs">tgs = (2:0.5:10)*1E-9 # gate times
Fg_res = Matrix{Float64}(undef,length(tgs),2) # initialize matrix for number of solves
axialkets  = [normalize!(Ket([1,1,0])),   # +X
              normalize!(Ket([1,-1,0])),  # -X
              normalize!(Ket([1,im,0])),  # +Y
              normalize!(Ket([1,-im,0])), # -Y
              normalize!(Ket([1,0,0])),   # +Z
              normalize!(Ket([0,1,0]))]   # -Z
axialops = Operator.(axialkets) # need density operators too

Uideal = qeye(3); Uideal[1:2,1:2] = data(σx)
for (i,tg) in enumerate(tgs)
    sum1 = 0 # sum of Gaussian gate fidelities
    sum2 = 0 # sum of DRAG gate fidelities
    for j = 1:6
        ket = axialkets[j]
        op = axialops[j]
        tspan = (-tg/2,tg/2)
        # Gaussian
        res4_1 = sesolve((Hc,(Hd,rotgaussianpulse,[tg,σ,π])),ket,tspan)
        sum1 += trace(Uideal*op*Uideal&#39;*(res4_1.states[end]*res4_1.states[end]&#39;))
        # DRAG
        res4_2 = sesolve((Hc,(Hdet,dydet,[tg,σ,π,Δ,λ]),(Hdx,DRAGx,[tg,σ,π,Δ,λ]),(Hdy,DRAGy,[tg,σ,π,Δ,λ])),ket,tspan)
        sum2 += trace(Uideal*op*Uideal&#39;*(res4_2.states[end]*res4_2.states[end]&#39;))
    end
    Fg_res[i,:] = [sum1/6 sum2/6] # take average
end

plot(tgs*1E9, 1 .- Fg_res); ylim([10E-8,1]); grid()
title(&quot;Average gate fidelity averaging over all input states&quot;);
yscale(&quot;log&quot;); xlabel(&quot;Gate Time (ns)&quot;); ylabel(&quot;Gate Error 1-Fg&quot;);
legend([&quot;Gaussian&quot;,&quot;DRAG 5th Order&quot;]);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Assignment to `tspan` in soft scope is ambiguous because a global variable by the same name exists: `tspan` will be treated as a new local. Disambiguate by using `local tspan` to suppress this warning or `global tspan` to assign to the existing global variable.
└ @ DRAG.md:148</code></pre><p><img src="img/fidelities.svg" alt="NOT-gate fidelities"/></p><p>For a gate time of 6ns, taking advantage of DRAG results in a gate error that is 2 orders of magnitude less than when using Gaussian pulses.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ol><li>Motzoi, F., Gambetta, J. M., Rebentrost, P., &amp; Wilhelm, F. K. (2009). Simple Pulses for Elimination of Leakage in Weakly Nonlinear Qubits. Physical Review Letters, 103(11), 110501. <a href="https://doi.org/10.1103/PhysRevLett.103.110501">10.1103/PhysRevLett.103.110501</a> or <a href="https://arxiv.org/abs/0901.0534">arXiv:0901.0534</a></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="driven_TLS.html">« The Driven Two-Level System</a><a class="docs-footer-nextpage" href="../api/quobj.html">Quantum Object Types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 30 October 2023 21:37">Monday 30 October 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
